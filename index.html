<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UC Job Board (Archive)</title>
    <style>
        body { font-family: -apple-system, system-ui, sans-serif; background: #f4f7f6; max-width: 900px; margin: 0 auto; padding: 2rem; color: #333; }
        header { text-align: center; margin-bottom: 2rem; }
        h1 { color: #005596; margin-bottom: 0.5rem; }
        
        .stats-bar { font-size: 0.9rem; color: #666; margin-bottom: 1rem; font-weight: 600; }
        
        .controls { background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); margin-bottom: 2rem; }
        .search-row { display: grid; grid-template-columns: 1fr 1fr auto; gap: 10px; margin-bottom: 1rem; }
        
        input, select { padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 1rem; width: 100%; }
        
        /* Category Checkboxes */
        .category-filter { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; padding-top: 10px; border-top: 1px solid #eee; }
        .cat-chip { font-size: 0.75rem; background: #f0f0f0; padding: 5px 10px; border-radius: 20px; cursor: pointer; border: 1px solid #ddd; transition: 0.2s; }
        .cat-chip.active { background: #005596; color: white; border-color: #005596; }

        .job-card { background: white; padding: 1.5rem; margin-bottom: 0.8rem; border-radius: 6px; border: 1px solid #eee; text-decoration: none; color: inherit; display: block; transition: 0.2s; }
        .job-card:hover { border-color: #005596; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .job-title { font-weight: bold; color: #005596; margin-bottom: 6px; font-size: 1.1rem; }
        .job-meta { display: flex; justify-content: space-between; font-size: 0.85rem; color: #666; margin-bottom: 10px; }
        .job-category { display: inline-block; background: #e1e8ed; color: #005596; padding: 3px 10px; border-radius: 4px; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; }
        
        @media (max-width: 600px) { .search-row { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <header>
        <h1>UC Job Board</h1>
        <div class="subtitle">Rolling 30-Day Archive</div>
    </header>

    <div class="stats-bar">
        Showing <span id="currentCount">0</span> of <span id="totalCount">0</span> total jobs
    </div>

    <div class="controls">
        <div class="search-row">
            <input type="text" id="searchInput" placeholder="Keyword search..." oninput="filterJobs()">
            <select id="campusFilter" onchange="filterJobs()">
                <option value="">All Locations</option>
                <option value="Davis">UC Davis / Health</option>
                <option value="Berkeley">UC Berkeley</option>
                <option value="San Francisco">UCSF / Health</option>
                <option value="Los Angeles">UCLA / Health</option>
                </select>
            <button onclick="loadJobs()">üîÑ</button>
        </div>
        <div id="categoryChips" class="category-filter">
            </div>
    </div>

    <main id="app"></main>

    <script>
        let allJobs = [];
        let selectedCategories = new Set();

        async function loadJobs() {
            const app = document.getElementById('app');
            app.innerHTML = 'Loading...';
            try {
                const res = await fetch('jobs.json?v=' + Date.now());
                const data = await res.json();
                allJobs = data.results || [];
                document.getElementById('totalCount').textContent = allJobs.length;
                
                generateCategoryChips();
                filterJobs();
            } catch (e) { app.innerHTML = 'Error loading data.'; }
        }

        function generateCategoryChips() {
            const container = document.getElementById('categoryChips');
            const categories = [...new Set(allJobs.map(j => j.category || 'N/A'))].sort();
            
            container.innerHTML = categories.map(cat => `
                <div class="cat-chip" onclick="toggleCategory('${cat}', this)">${cat}</div>
            `).join('');
        }

        function toggleCategory(cat, el) {
            if (selectedCategories.has(cat)) {
                selectedCategories.delete(cat);
                el.classList.remove('active');
            } else {
                selectedCategories.add(cat);
                el.classList.add('active');
            }
            filterJobs();
        }

        function filterJobs() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const campus = document.getElementById('campusFilter').value;
            const app = document.getElementById('app');

            const filtered = allJobs.filter(j => {
                const matchesSearch = (j.title + " " + (j.category || "")).toLowerCase().includes(query);
                const matchesCampus = campus === "" || j.location.includes(campus);
                const matchesCategory = selectedCategories.size === 0 || selectedCategories.has(j.category || 'N/A');
                
                return matchesSearch && matchesCampus && matchesCategory;
            });

            document.getElementById('currentCount').textContent = filtered.length;
            app.innerHTML = filtered.map(j => `
                <a href="${j.url}" target="_blank" class="job-card">
                    <div class="job-title">${j.title}</div>
                    <div class="job-meta">
                        <span>üìç ${j.location}</span>
                        <span>üìÖ ${j.date}</span>
                    </div>
                    <div class="job-category">${j.category || 'N/A'}</div>
                </a>
            `).join('');
        }

        loadJobs();
    </script>
</body>
</html>
